# GUI 介面實作計畫

## 概述

本實作計畫將為易經卜卦系統添加圖形化使用者介面（GUI），使用 Python 的 tkinter 庫。所有任務都專注於 GUI 層的實作，重用現有的核心業務邏輯。

---

- [x] 1. 建立 GUI 模組結構和樣式配置





  - 建立 `src/gui/` 目錄結構
  - 建立 `src/gui/__init__.py`
  - 實作 `src/gui/styles.py`，定義顏色、字體、尺寸常數
  - 實作跨平台字體選擇函數
  - 實作 `src/gui/utils.py`，包含通用 GUI 工具函數（錯誤對話框、確認對話框等）
  - _需求: 6.6, 7.1, 7.3, 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 2. 實作卦象顯示元件





  - 建立 `src/gui/hexagram_display.py`
  - 實作 `HexagramDisplay` 類別
  - 實作 `draw_hexagram()` 方法，使用 Canvas 繪製卦象
  - 實作 `draw_yao()` 方法，繪製單個爻（陽爻實線、陰爻斷線）
  - 實作變爻標記功能（使用不同顏色或符號）
  - 實作卦名和基本資訊顯示
  - 實作 `clear()` 方法清除畫布
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 7.2_

- [x] 3. 實作主視窗框架





  - 建立 `src/gui/main_window.py`
  - 實作 `MainWindow` 類別
  - 初始化 tkinter 根視窗，設定標題、大小、圖示
  - 實作 `show_home()` 方法，顯示主選單（開始卜卦、查看歷史、關於按鈕）
  - 實作視窗切換邏輯（使用 Frame 切換或新視窗）
  - 實作 `show_about()` 方法，顯示關於資訊
  - 處理視窗關閉事件
  - _需求: 1.1, 1.2, 1.3, 1.4, 8.1, 8.2, 8.3_

- [x] 4. 實作卜卦介面 - 輸入階段





  - 建立 `src/gui/divination_frame.py`
  - 實作 `DivinationFrame` 類別
  - 建立問題輸入介面（Label、Text 或 Entry 元件）
  - 實作「開始占卜」按鈕和事件處理
  - 實作輸入驗證（確保問題不為空）
  - 實作「返回」按鈕返回主選單
  - _需求: 2.1, 2.2, 6.3_

- [x] 5. 實作卜卦介面 - 結果顯示





  - 在 `DivinationFrame` 中實作 `perform_divination()` 方法
  - 呼叫 `DivinationService.perform_divination()` 執行卜卦
  - 實作 `display_result()` 方法顯示卜卦結果
  - 使用 `HexagramDisplay` 顯示本卦和之卦（如果有）
  - 實作可滾動的文字區域顯示卦辭和爻辭
  - 高亮顯示變爻的爻辭
  - _需求: 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6. 實作卜卦介面 - 儲存功能




  - 在 `DivinationFrame` 中實作「儲存記錄」按鈕
  - 實作 `save_to_history()` 方法
  - 呼叫 `HistoryManager.save_record()` 儲存結果
  - 顯示儲存成功或失敗的訊息
  - 處理儲存過程中的錯誤
  - _需求: 2.5, 6.2_

- [x] 7. 實作歷史記錄介面 - 列表顯示






  - 建立 `src/gui/history_frame.py`
  - 實作 `HistoryFrame` 類別
  - 實作 `load_records()` 方法，從 `HistoryManager` 載入記錄
  - 使用 Listbox 或 Treeview 顯示記錄列表（日期、問題、卦名）
  - 實作列表項目的格式化顯示
  - 實作「返回」按鈕返回主選單
  - _需求: 5.1, 5.2_

- [x] 8. 實作歷史記錄介面 - 搜尋功能





  - 在 `HistoryFrame` 中添加搜尋輸入框
  - 實作 `search_records()` 方法
  - 實作即時搜尋過濾（使用 Entry 的 trace 或按鈕觸發）
  - 更新列表顯示過濾後的結果
  - 實作清除搜尋功能
  - _需求: 5.3, 5.4_

- [x] 9. 實作歷史記錄介面 - 詳情顯示






  - 實作雙擊或按鈕觸發查看詳情
  - 實作 `show_record_detail()` 方法
  - 從 `HistoryManager` 獲取完整記錄
  - 使用 `HexagramDisplay` 顯示記錄中的卦象
  - 顯示完整的卦辭和爻辭
  - 實作「返回列表」按鈕
  - _需求: 5.5, 5.6_

- [x] 10. 實作錯誤處理和使用者反饋






  - 在所有 GUI 元件中添加 try-except 錯誤處理
  - 實作資料載入錯誤的處理（顯示錯誤對話框並退出）
  - 實作歷史記錄錯誤的處理（顯示警告但允許繼續）
  - 實作操作成功的提示訊息（使用 messagebox）
  - 實作載入指示器或進度提示（如果需要）
  - _需求: 6.1, 6.2, 6.3_

- [x] 11. 實作響應式佈局和視覺優化





  - 使用 grid 或 pack 佈局管理器實現響應式佈局
  - 設定元件的 weight 屬性支援視窗縮放
  - 實作統一的內邊距和外邊距
  - 應用 Styles 中定義的配色方案
  - 測試不同視窗大小下的顯示效果
  - _需求: 6.4, 7.3_

- [x] 12. 建立 GUI 程式入口點





  - 建立 `main_gui.py` 作為 GUI 程式入口
  - 初始化 `HexagramDatabase`
  - 初始化 `HistoryManager`
  - 初始化 `DivinationService`
  - 建立 tkinter 根視窗
  - 初始化並顯示 `MainWindow`
  - 啟動 tkinter 主迴圈
  - 添加頂層異常處理
  - _需求: 所有需求的整合_

- [x] 13. 跨平台測試和優化




  - 在 Windows 上測試 GUI 顯示和功能
  - 在 macOS 上測試 GUI 顯示和功能（如果可能）
  - 在 Linux 上測試 GUI 顯示和功能（如果可能）
  - 測試中文字元顯示
  - 調整字體和樣式以適應不同平台
  - 修復平台特定的問題
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 14. 撰寫 GUI 使用文件






  - 更新 README.md，添加 GUI 使用說明
  - 說明如何啟動 GUI 版本（`python main_gui.py`）
  - 添加 GUI 介面的截圖或說明
  - 說明 GUI 的主要功能和操作方式
  - 添加常見問題解答（GUI 相關）
  - _需求: 使用者體驗_

---

## 可選任務（進階功能）

以下任務為可選的進階功能，標記為 `*` 表示非核心功能必需：

- [ ]* 15.1 實作卜卦動畫效果
  - 實作銅錢翻轉動畫
  - 實作爻的逐個生成動畫
  - 實作視窗切換過渡動畫
  - _需求: 6.1, 未來擴展_

- [ ]* 15.2 實作主題切換功能
  - 實作明亮/暗黑模式切換
  - 允許使用者自訂配色方案
  - 儲存使用者的主題偏好
  - _需求: 未來擴展_

- [ ]* 15.3 實作匯出功能
  - 實作匯出卜卦結果為圖片（PNG）
  - 實作匯出歷史記錄為 PDF
  - 實作複製結果到剪貼簿
  - _需求: 未來擴展_

- [ ]* 15.4 撰寫 GUI 單元測試
  - 測試 HexagramDisplay 的繪製邏輯
  - 測試樣式配置
  - 測試 GUI 工具函數
  - 測試視窗切換邏輯
  - _需求: 測試覆蓋率_

---

## 實作順序建議

建議按照以下順序實作任務，以確保每個階段都有可測試的成果：

1. **階段 1：基礎設施** (任務 1, 2, 3)
   - 建立模組結構、樣式配置
   - 實作卦象顯示元件
   - 實作主視窗框架

2. **階段 2：卜卦功能** (任務 4, 5, 6)
   - 實作卜卦介面的輸入、顯示、儲存

3. **階段 3：歷史記錄** (任務 7, 8, 9)
   - 實作歷史記錄的列表、搜尋、詳情

4. **階段 4：完善和整合** (任務 10, 11, 12)
   - 錯誤處理、佈局優化、程式入口

5. **階段 5：測試和文件** (任務 13, 14)
   - 跨平台測試、文件撰寫

---

## 如何開始

1. 確保已完成 CLI 版本的所有核心功能
2. 從任務 1 開始，按順序實作
3. 每完成一個任務，進行簡單測試確保功能正常
4. 完成階段 1 後，應該能看到主視窗和基本的卦象顯示
5. 完成階段 2 後，應該能進行完整的卜卦流程
6. 完成階段 3 後，應該能管理歷史記錄
7. 完成階段 4 後，系統應該完整可用
8. 完成階段 5 後，系統應該經過測試並有完整文件

---

**預估工作量：** 約 12-16 小時（取決於經驗和測試範圍）

**技術需求：**
- Python 3.8+
- tkinter（Python 內建）
- 現有的核心業務邏輯模組

**成功標準：**
- ✅ 所有核心任務（1-14）完成
- ✅ GUI 在至少一個平台上正常運作
- ✅ 所有核心功能可透過 GUI 使用
- ✅ 中文字元正確顯示
- ✅ 有基本的錯誤處理
- ✅ 有使用文件
